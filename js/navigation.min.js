function clearAllPolylinesMap(){for(i in map._layers){if(map._layers[i]._path!=undefined){try{map.removeLayer(map._layers[i])}catch(e){console.log("problem with "+e+map._layers[i])}}}}L.Control.SimpleMarkers=L.Control.extend({options:{position:"topleft"},onAdd:function(){var e=L.DomUtil.create("div","marker_controls");var t=L.DomUtil.create("div","add_marker_control",e);var n=L.DomUtil.create("div","del_marker_control",e);t.title="Add a marker";n.title="Delete a marker";L.DomEvent.addListener(t,"click",L.DomEvent.stopPropagation).addListener(t,"click",L.DomEvent.preventDefault).addListener(t,"click",function(){this.enterAddMarkerMode()}.bind(this));L.DomEvent.addListener(n,"click",L.DomEvent.stopPropagation).addListener(n,"click",L.DomEvent.preventDefault).addListener(n,"click",function(){this.enterDelMarkerMode()}.bind(this));return e},enterAddMarkerMode:function(){if(markerList!==""){for(var e=0;e<markerList.length;e++){if(typeof markerList[e]!=="undefined"){markerList[e].removeEventListener("click",this.onMarkerClickDelete)}}}document.getElementById("map").style.cursor="crosshair";map.addEventListener("click",this.onMapClickAddMarker)},enterDelMarkerMode:function(){for(var e=0;e<markerList.length;e++){if(typeof markerList[e]!=="undefined"){markerList[e].addEventListener("click",this.onMarkerClickDelete)}}},onMapClickAddMarker:function(e){map.removeEventListener("click");document.getElementById("map").style.cursor="auto";var t=new LatLon(Geo.parseDMS(e.latlng.lat),Geo.parseDMS(e.latlng.lng));var n=new L.LatLng(e.latlng.lat,e.latlng.lng);var r=new LatLon(Geo.parseDMS(myLat),Geo.parseDMS(myLng));var i=new L.LatLng(myLat,myLng);var s=r.bearingTo(t);var o=r.distanceTo(t);var u=parseFloat($("#windRichtung").val());var a=$("#windSpeed").val();var f=parseInt($("#distLayline").val());for(var l in best_beat_ARR){if(best_beat_ARR[l]["wind"]=a){AlphaA=best_beat_ARR[l]["winkel"];v=best_beat_ARR[l]["v"]}}var c=KursWinkel_KursLaenge(t,r,AlphaA,u,s,o,a,f);var h=c[0]<360?c[0]:c[0]-360;var p=c[1];var d=c[2];var m=c[3];var g=c[4];var y=r.destinationPoint(h,p).toString().split(", ");var b=new L.LatLng(Geo.parseDMS(y[0]),Geo.parseDMS(y[1]));var w=[i,b];var E=r.destinationPoint(h,p).toString().split(", ");var S=new LatLon(Geo.parseDMS(y[0]),Geo.parseDMS(y[1]));var x=new L.LatLng(Geo.parseDMS(y[0]),Geo.parseDMS(y[1]));Kurs=!g?(new L.polyline(w,{color:"blue",weight:2,opacity:.5,smoothFactor:1})).addTo(map):(new L.polyline(w,{color:"#505050",weight:1,opacity:1,smoothFactor:1,dashArray:"20,15"})).addTo(map);$("#Navi_Wegpunkt").empty();$("#Navi_Geschwindigkeit").empty();if(!g){var T="<table width='100%' cellpadding='1' cellspacing='0' border='0'"+"<tr><td align='left'>Bei einer Windstärke von: </td><td align='right'>"+$("#windSpeed").val()+"</td><td align='left'>kn</td></tr>"+"<tr><td align='left'>ergibt sich eine Schiffs-Geschwindigkeit: </td><td align='right'>"+round(v,2)+"</td><td align='left'>kn</td></tr>"+"<tr><td align='left'>bei einem optimalen Kurs zum Wind: </td><td align='right'>"+AlphaA+"</td><td align='left'>°</td></tr>"+"</table>";$("#Navi_Geschwindigkeit").append(T);var T="<hr size='1px' align='center' width='70%' color='#c0c0c0' noshade>Wegpunkt: "+"φ: "+dd2dm(e.latlng.lat,"lat",5)+"; λ: "+dd2dm(e.latlng.lng,"lng",5);T+="<table width='100%' cellpadding='1' cellspacing='0' border='0'"+"<tr><td align='left'>Distanz Luftlinie Schiff-Wegpunkt: </td><td align='right'>"+km2nm(o)+"</td><td align='left'>sm</td></tr>"+"<tr><td align='left'>Distanz bis zum 1. Wendepunkt: </td><td align='right'>"+round(p,2)+"</td><td align='left'>sm</td></tr>"+"<tr><td align='left'>Zeit bis zum 1. Wendepunkt: </td><td align='right'>"+round(p*60/v,2)+"</td><td align='left'>min</td></tr>"+"<tr><td align='left'>schnellster Kurs zum 1. Wendepunkt: </td><td align='right'>"+round(h,2)+"</td><td align='left'>°</td></tr>"+"</table>"+"<hr size='1px' align='center' width='70%' color='#c0c0c0' noshade>"+"1. Wendepunkt: φ: "+dd2dm(Geo.parseDMS(y[0]),"lat",5)+"; λ: "+dd2dm(Geo.parseDMS(y[1]),"lng",5);$("#Navi_Wegpunkt").append(T)}var N=S.bearingTo(t);var C=S.distanceTo(t);var c=KursWinkel_KursLaenge(t,S,AlphaA,u,N,C,a,f);var k=c[0];var A=c[1];var O=c[2];var M=c[3];var _=S.destinationPoint(k,A).toString().split(", ");var D=new L.LatLng(Geo.parseDMS(_[0]),Geo.parseDMS(_[1]));var P=[x,D];var H=S.destinationPoint(k,A).toString().split(", ");var B=new LatLon(Geo.parseDMS(_[0]),Geo.parseDMS(_[1]));var j=new L.LatLng(Geo.parseDMS(_[0]),Geo.parseDMS(_[1]));Kurs=!g?(new L.polyline(P,{color:"blue",weight:2,opacity:.5,smoothFactor:1})).addTo(map):(new L.polyline(P,{color:"#505050",weight:1,opacity:1,smoothFactor:1,dashArray:"20,15"})).addTo(map);var F=B.bearingTo(t);var I=B.distanceTo(t);if(!g){var T="<table width='100%' cellpadding='1' cellspacing='0' border='0'"+"<tr><td align='left'>Distanz Luftlinie 1. Wendepunkt-Wegpunkt: </td><td align='right'>"+km2nm(C)+"</td><td align='left'>sm</td></tr>"+"<tr><td align='left'>Distanz bis zum 2. Wendepunkt: </td><td align='right'>"+round(A,2)+"</td><td align='left'>sm</td></tr>"+"<tr><td align='left'>Zeit bis zum 2. Wendepunkt: </td><td align='right'>"+round(A*60/v,2)+"</td><td align='left'>min</td></tr>"+"<tr><td align='left'>schnellster Kurs zum 2. Wendepunkt: </td><td align='right'>"+round(k,2)+"</td><td align='left'>°</td></tr>"+"</table>"+"<hr size='1px' align='center' width='70%' color='#c0c0c0' noshade>"+"2. Wendepunkt: φ: "+dd2dm(Geo.parseDMS(_[0]),"lat",5)+"; λ: "+dd2dm(Geo.parseDMS(_[1]),"lng",5);$("#Navi_Wegpunkt").append(T)}var q=B.bearingTo(t);var R=B.distanceTo(t);var c=KursWinkel_KursLaenge(t,B,AlphaA,u,F,I,a,f);var U=c[0];var z=c[1];var W=c[2];var X=c[3];var V=B.destinationPoint(U,z).toString().split(", ");var J=new L.LatLng(Geo.parseDMS(V[0]),Geo.parseDMS(V[1]));var K=[j,J];var Q=B.destinationPoint(U,z).toString().split(", ");Kurs=!g?(new L.polyline(K,{color:"blue",weight:2,opacity:.5,smoothFactor:1})).addTo(map):(new L.polyline(K,{color:"#505050",weight:1,opacity:1,smoothFactor:1,dashArray:"20,15"})).addTo(map);if(!g){var T="<table width='100%' cellpadding='1' cellspacing='0' border='0'"+"<tr><td align='left'>Distanz Luftlinie 2. Wendepunkt-Wegpunkt: </td><td align='right'>"+km2nm(I)+"</td><td align='left'>sm</td></tr>"+"<tr><td align='left'>Distanz bis zum 3. Wendepunkt: </td><td align='right'>"+round(z,2)+"</td><td align='left'>sm</td></tr>"+"<tr><td align='left'>Zeit bis zum 3. Wendepunkt: </td><td align='right'>"+round(z*60/v,2)+"</td><td align='left'>min</td></tr>"+"<tr><td align='left'>schnellster Kurs zum 3. Wendepunkt: </td><td align='right'>"+round(U,2)+"</td><td align='left'>°</td></tr>"+"</table>"}else{T="<hr size='1px' align='center' width='70%' color='#c0c0c0' noshade><b>ACHTUNG:</b> Wegpunkt liegt ausserhalb der Laylines <br>und wird in dieser Version der Applikation nicht berechnet!"}$("#Navi_Wegpunkt").append(T);var G=d;var Y=m;var Z=G*2;var et=Y*2;var tt=u+180;var nt=tt-G<360?tt-G:tt-G-360;var rt=tt+G<360?tt+G:tt+G-360;var it=tt-Y<360?tt-Y:tt-Y-360;var st=tt+Y<360?tt+Y:tt+Y-360;var ot=r.distanceTo(t)*1.2;var ut=t.destinationPoint(nt,ot).toString().split(", ");var at=new L.LatLng(Geo.parseDMS(ut[0]),Geo.parseDMS(ut[1]));var ft=[n,at];var lt=t.destinationPoint(it,ot).toString().split(", ");var ct=new L.LatLng(Geo.parseDMS(lt[0]),Geo.parseDMS(lt[1]));var ht=[n,ct];var pt=t.destinationPoint(rt,ot).toString().split(", ");var dt=new L.LatLng(Geo.parseDMS(pt[0]),Geo.parseDMS(pt[1]));var vt=[n,dt];var mt=t.destinationPoint(st,ot).toString().split(", ");var gt=new L.LatLng(Geo.parseDMS(mt[0]),Geo.parseDMS(mt[1]));var yt=[n,gt];ut=(new L.polyline(ft,{color:"green",weight:2,opacity:.5,smoothFactor:1})).addTo(map);lt=(new L.polyline(ht,{color:"green",weight:2,opacity:.5,smoothFactor:1,dashArray:"10,10"})).addTo(map);pt=(new L.polyline(vt,{color:"red",weight:2,opacity:.5,smoothFactor:1})).addTo(map);mt=(new L.polyline(yt,{color:"red",weight:2,opacity:.5,smoothFactor:1,dashArray:"10,10"})).addTo(map);var bt="φ: "+dd2dm(e.latlng.lat,"lat",5)+"<br/>λ: "+dd2dm(e.latlng.lng,"lng",5);var wt=L.popup({maxWidth:160,closeButton:true});wt.setContent(bt);var Et=L.marker(e.latlng);Et.addTo(map);Et.bindPopup(wt).openPopup();markerList.push(Et);var St=[i,n];WayPoint2Ship=(new L.polyline(St,{color:"#505050",weight:1,opacity:.5,smoothFactor:1,dashArray:"20,15"})).addTo(map);$("#popupShowNavigation").popup("open");return false},onMarkerClickDelete:function(e){map.removeLayer(this);var t=markerList.indexOf(this);delete markerList[t];for(var n=0;n<markerList.length;n++){if(typeof markerList[n]!=="undefined"){markerList[n].removeEventListener("click",arguments.callee)}}clearAllPolylinesMap();$("#Navi_Wegpunkt").empty();$("#Navi_Wegpunkt").append("<hr size='1px' align='center' width='70%' color='#c0c0c0' noshade><b>ACHTUNG:</b> Kein Wegpunkt definiert!");return false}});var markerList=[]
